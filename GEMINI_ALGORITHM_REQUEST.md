# Gemini CLI 气象算法请求模板

## 角色设定
你现在是一名高级气象物理学家和数值天气预报工程师，请针对大型手机端气象沙盘模拟器输出**完整数学公式、数值算法和Dart可实现方案**。

## 目标模块与详细要求

### 1. 风场动力学方程求解器
**目标：** 在 `lib/services/wind_solver.dart` 中实现完整的 Navier-Stokes 方程求解

**具体要求：**
- 使用 Navier-Stokes 方程在地转风平衡下的简化形式
- 提供水平风分量 u,v 的离散化数值格式
- 支持二维网格 (x,y) 演化，考虑科里奥利力
- 给出数值稳定性条件(CFL条件)的具体计算
- 输出可直接替换 `solveWindField()` 方法的完整算法

**数学基础：**
```
∂u/∂t + u·∇u = -1/ρ ∂p/∂x + fv + ν∇²u
∂v/∂t + u·∇v = -1/ρ ∂p/∂y - fu + ν∇²v
```

### 2. 水汽扩散与对流参数化
**目标：** 在 `lib/services/diffusion_service.dart` 中实现水汽输送方程

**具体要求：**
- 实现水汽输送方程 ∂q/∂t + u·∇q = K∇²q
- 对流触发机制：当 q 和温度达到阈值触发上升运动
- 提供有限差分离散方案
- 给出数值稳定性条件和边界处理
- 输出可直接替换 `solveDiffusion()` 方法的算法

**关键算法点：**
- 饱和水汽压计算
- 对流速度计算
- 水汽守恒约束

### 3. 降水形成机制（Kessler微物理方案）
**目标：** 在 `lib/services/precipitation_solver.dart` 中实现完整的微物理过程

**具体要求：**
- 包括水汽→云水→雨水的完整转化链
- 质量守恒方程的数值实现
- 给出时间步进的离散形式
- 包含自动转化、碰并、蒸发等过程
- 输出可直接替换 `solvePrecipitation()` 的详细算法

**微物理过程：**
- 凝结/蒸发过程
- 自动转化过程
- 碰并增长过程
- 雨水下沉过程

### 4. 锋面动力学与演变模型
**目标：** 在 `lib/services/fronts_solver.dart` 中实现锋生函数和锋面移动

**具体要求：**
- 定义锋生函数 F(x,y,t) 的数学表达式
- 锋面移动速度计算方法
- 与网格状态更新公式的集成
- 锋面类型识别（冷锋、暖锋、静止锋）
- 输出完整的锋面追踪算法

**算法要点：**
- 温度梯度和湿度梯度计算
- 锋面强度计算
- 锋面移动轨迹预测

### 5. 辐射传输过程
**目标：** 在 `lib/services/radiation_solver.dart` 中实现短波和长波辐射

**具体要求：**
- 短波与长波辐射的参数化方案
- 对地表和大气吸收、反射计算公式
- 太阳高度角计算
- 云辐射相互作用
- 输出逐网格数值实现方法

**辐射计算：**
- 太阳辐射传输
- 大气发射率计算
- 地表能量平衡

### 6. 边界层湍流参数化
**目标：** 在 `lib/services/boundary_layer_solver.dart` 中实现 M-O 相似理论

**具体要求：**
- M-O 相似理论和 K 理论离散化
- 湍流混合长度计算公式
- 稳定性函数计算
- 边界层高度确定
- 输出数值实现方法

**关键参数：**
- von Karman 常数应用
- 摩擦速度计算
- 湍流交换系数确定

## 输出要求

### 格式要求
每个模块都必须提供：
1. **数学公式**（用标准数学符号表示）
2. **网格离散化公式**（有限差分格式）
3. **时间步进方法**（显式/隐式方案）
4. **数值实现伪代码**（容易转换为 Dart）

### 集成要求
- 模块之间提供接口说明
- u,v,w,q 与降水、锋面、辐射等的耦合方式
- 保证数值稳定性和可计算性
- 输出可直接用于手机端 Flutter/Dart 实现

### 性能要求
- 考虑手机端计算能力限制
- 优化内存使用
- 提供100×100×20网格的高效算法

## 技术约束

### 网格规格
- 水平分辨率：1km
- 垂直分辨率：200m
- 时间步长：0.1秒
- 模拟间隔：3秒

### 数值稳定性
- CFL条件：CFL < 0.5
- 扩散稳定性：CFL < 0.25
- 边界条件：周期性/固定边界

### 物理常数
- 重力加速度：9.81 m/s²
- 气体常数：287.05 J/(kg·K)
- 科里奥利参数：随纬度变化
- 太阳常数：1367 W/m²

## 期望输出

请按模块顺序输出完整的算法实现，每个模块包含：
1. 理论基础和数学推导
2. 离散化方案
3. 伪代码实现
4. 稳定性分析
5. 与其他模块的接口定义

输出应该可以直接集成到现有的 Dart 代码框架中，替换相应的 TODO 部分。